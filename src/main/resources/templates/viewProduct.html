<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/custom.css}" href="../static/css/custom.css">
    <title>EcommerceFresh - Product Details</title>
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img th:src="@{/images/logo.png}" src="../static/images/logo.png" width="auto" height="40"
                 class="d-inline-block align-top" alt=""/>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto"></ul>
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" th:href="@{/}" href="#">home</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" th:href="@{/shop}" href="#">shop</a>
                </li>
                <li class="nav-item active dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Profile
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" th:href="@{/profile}">My Profile</a>
                        <a class="dropdown-item" th:href="@{/profile/orders}">My Orders</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" th:href="@{/logout}">Logout</a>
                    </div>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" sec:authorize="isAnonymous()" th:href="@{/login}" href="#">login</a>
                </li>
                <li class="nav-item active" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/wishlist}" href="#">wishlist</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" th:href="@{/cart}" href="#">cart</a>
                </li>
                <li class="nav-item active">
                    <span class="nav-link" th:text="${cartCount}"></span>
                </li>
            </ul>

        </div>
    </div>
</nav>
<div class="container mt-5">
    <div class="row">
        <div class="col-sm-5 d-flex justify-content-center">
            <img class="mt-5" height="300px" width="300px" src="" th:src="@{${'/productImages/' + product.imageName}}"
                 alt="">
        </div>
        <div class="col-sm-7 mt-5">
            <h2 th:text="${product.name}"></h2>
            <p th:text="${product.category.name}"></p>
            
            <!-- Discount Badge -->
            <div th:if="${activeDiscount != null}">
                <span class="badge badge-danger" th:text="${activeDiscount.calculateDiscountPercentage() + '% OFF'}">20% OFF</span>
            </div>
            
            <!-- Price Section -->
            <div th:if="${activeDiscount != null}">
                <h2>
                    <span class="text-muted" style="text-decoration: line-through;">₹<span th:text="${product.price}"></span></span>
                    <span class="text-danger ml-2">₹<span th:text="${#numbers.formatDecimal(effectivePrice, 0, 2)}"></span></span>
                </h2>
                <div class="alert alert-info" th:text="'Discount ends in ' + ${activeDiscount.getTimeRemaining()}">
                    Discount ends in 2 hours 30 minutes
                </div>
            </div>
            <div th:unless="${activeDiscount != null}">
                <h2>₹ <span th:text="${product.price}"></span></h2>
            </div>
            
            <h5>Weight:
                <spna th:text="${product.weight}"></spna> grams.
            </h5>
            <p th:text="${product.description}"></p>
            <div class="mb-3">
                <strong>Average rating:</strong>
                <span th:text="${formattedAverage}">0.0</span>
                <span class="ml-2 text-warning">
                    <i th:each="i: ${#numbers.sequence(1, (roundedAverage?:0))}" class="fas fa-star"></i>
                </span>
            </div>
            <div th:if="${#authorization.expression('isAuthenticated()')}">
                <form th:action="@{/product/{id}/rate(id=${product.id})}" method="post" class="form-inline mb-3">
                    <div th:if="${_csrf != null}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    </div>
                    <label class="mr-2">Rate:</label>
                    <select name="score" class="form-control mr-2">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <input type="text" name="comment" class="form-control mr-2" placeholder="Add a comment (optional)">
                    <button class="btn btn-primary" type="submit">Submit</button>
                </form>
            </div>

            <div class="mb-3">
                <label>Sort reviews:</label>
                <a th:href="@{/shop/viewproduct/{id}(id=${product.id}, sort='recent')}" class="btn btn-sm btn-outline-secondary ml-2" th:classappend="${sort == 'recent'} ? ' active'">Recent</a>
                <a th:href="@{/shop/viewproduct/{id}(id=${product.id}, sort='top')}" class="btn btn-sm btn-outline-secondary ml-1" th:classappend="${sort == 'top'} ? ' active'">Top rated</a>
            </div>

            <div>
                <h5>Reviews</h5>
                <div th:if="${ratings == null or #lists.isEmpty(ratings)}">
                    <div class="text-muted">No reviews yet.</div>
                </div>
                <div th:each="r : ${ratings}" class="border p-3 mb-2">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong th:text="${r.users.firstName}">User</strong>
                            <small class="text-muted ml-2" th:text="${r.createdAt != null ? r.createdAt.format(T(java.time.format.DateTimeFormatter).ofPattern('dd MMM yyyy HH:mm')) : ''}"></small>
                        </div>
                        <div class="text-warning">
                            <i th:each="i: ${#numbers.sequence(1, r.score)}" class="fas fa-star"></i>
                        </div>
                    </div>
                    <p th:text="${r.comment}" class="mt-2"></p>
                </div>
            </div>
            <a href="" th:href="@{/addToCart/{id}(id = ${product.id})}" class="btn btn-primary">Add to cart</a>
            <span sec:authorize="isAuthenticated()">
                <form th:if="${wishlistIds != null and wishlistIds.contains(product.id)}" th:action="@{'/wishlist/remove/' + ${product.id} + '/form'}" method="post" style="display:inline-block; margin-left:8px;">
                    <div th:if="${_csrf != null}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    </div>
                    <button class="btn btn-outline-danger btn-sm" type="submit">Remove Wishlist</button>
                </form>
                <form th:if="${wishlistIds == null or !wishlistIds.contains(product.id)}" th:action="@{'/wishlist/add/' + ${product.id} + '/form'}" method="post" style="display:inline-block; margin-left:8px;">
                    <div th:if="${_csrf != null}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    </div>
                    <button class="btn btn-outline-primary btn-sm" type="submit">Add to Wishlist</button>
                </form>
            </span>
            <span sec:authorize="isAnonymous()">
                <a th:href="@{/login}" class="btn btn-outline-secondary btn-sm" style="margin-left:8px;">Login to wishlist</a>
            </span>
         </div>
     </div>
 </div>

<!-- Modern Footer -->
<footer class="modern-footer">
    <div class="footer-content">
        <div class="footer-section">
            <h5>EcommerceFresh</h5>
            <p>Your trusted partner for fresh, quality products delivered right to your doorstep. Experience the convenience of online shopping with our carefully curated selection.</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
        <div class="footer-section">
            <h5>Quick Links</h5>
            <ul>
                <li><a th:href="@{/}">Home</a></li>
                <li><a th:href="@{/shop}">Shop</a></li>
                <li><a th:href="@{/cart}">Cart</a></li>
                <li><a th:href="@{/wishlist}" sec:authorize="isAuthenticated()">Wishlist</a></li>
                <li><a th:href="@{/profile}" sec:authorize="isAuthenticated()">My Profile</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h5>Customer Service</h5>
            <ul>
                <li><a href="#">Help Center</a></li>
                <li><a href="#">Shipping Info</a></li>
                <li><a href="#">Returns & Exchanges</a></li>
                <li><a href="#">Track Your Order</a></li>
                <li><a href="#">Contact Us</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h5>Contact Info</h5>
            <p><i class="fas fa-map-marker-alt"></i> 123 Fresh Street, Market City, FC 12345</p>
            <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
            <p><i class="fas fa-envelope"></i> info@ecommercefresh.com</p>
            <p><i class="fas fa-clock"></i> Mon - Fri: 9:00 AM - 6:00 PM</p>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 EcommerceFresh. All rights reserved. | Made with <i class="fas fa-heart" style="color: #e74c3c;"></i> for fresh shopping experience</p>
    </div>
</footer>

<!-- Scroll to Top Button -->
<button class="scroll-to-top" onclick="scrollToTop()" id="scrollBtn" style="display: none;">
    <i class="fas fa-arrow-up"></i>
</button>

<script>
// Product view enhancements
document.addEventListener('DOMContentLoaded', function() {
    // Star rating hover effects
    const stars = document.querySelectorAll('.rating-stars .fas');
    stars.forEach(star => {
        star.style.cursor = 'pointer';
        star.addEventListener('mouseenter', function() {
            this.style.color = '#f39c12';
            this.style.transform = 'scale(1.2)';
        });
        star.addEventListener('mouseleave', function() {
            this.style.color = '#ffc107';
            this.style.transform = 'scale(1)';
        });
    });

    // Product image zoom effect
    const productImage = document.querySelector('.container img');
    if (productImage) {
        productImage.style.transition = 'all 0.3s ease';
        productImage.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
            this.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
        });
        productImage.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
        });
    }
});

// Scroll to Top Functionality
window.onscroll = function() {
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        document.getElementById("scrollBtn").style.display = "block";
    } else {
        document.getElementById("scrollBtn").style.display = "none";
    }
};

function scrollToTop() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}
</script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
</html>